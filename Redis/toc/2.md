# 数据结构：快速的Redis都有哪些慢操作
## Redis 键值对中值的数据类型，也就是数据的保存形式:
- String（字符串）
- List（列表）
- Hash（哈希）
- Set（集合）
- Sorted Set（有序集合）

## 底层数据结构
- 简单动态字符串
- 双向链表
- 压缩列表：列表表头存储**列表长度**、**列表尾的位置**、**列表元素个数**
- 哈希表
- 跳表： 在表头，存储索引，可直接跳到后四个的元素（多几个索引就可以非常快）
- 整数数组

## 数据类型和底层数据结构的关系
![](../meida/8219f7yy651e566d47cc9f661b399f01.webp)

## 键和值用什么结构组织？
- Redis采用全局哈希表进行存储，也就是哈希表内部元素不在存储元素，而是直接存一个个指针对象，指向对应的entry


## 如何解决哈希冲突
- 采用哈希链表解决第一步冲突
- 哈希冲突的时候，将相关数据rehash到哈希表2(内存是大于哈希表1)中，但不是一下子全部拷贝到rehash表2中，采用渐进式rehash(每次请求一次，rehash一次)，直到哈希表1空，释放哈希表1的内存

## 不同操作的复杂度
- 单元素操作是基础： 每一种集合类型对单个数据实现的增删改查操作
- 范围操作非常耗时： 集合类型中的遍历操作，可以返回集合中的所有数据（SCAN 来代替）
- 统计操作通常高效：集合类型对集合中所有元素个数的记录
- 例外情况只有几个：某些数据结构的特殊记录，例如压缩列表和双向链表都会记录表头和表尾的偏移量


## 常用问题：整数数组和压缩列表在查找时间复杂度方面并没有很大的优势，那为什么 Redis 还会把它们作为底层数据结构呢？
1、内存利用率，数组和压缩列表都是非常紧凑的数据结构，它比链表占用的内存要更少。Redis是内存数据库，大量数据存到内存中，此时需要做尽可能的优化，提高内存的利用率。

2、数组对CPU高速缓存支持更友好，所以Redis在设计时，集合数据元素较少情况下，默认采用内存紧凑排列的方式存储，同时利用CPU高速缓存不会降低访问速度。当数据元素超过设定阈值后，避免查询时间复杂度太高，转为哈希和跳表数据结构存储，保证查询效率。

3、Redis底层的使用数组和压缩链表对数据大小限制在64个字节以下，当大于64个字节会改变存储数据的数据结构，所以随机访问对于CPU高速缓存没啥影响。
